---
title: 设计模式之发布-订阅模式 
date: 2020-01-10 11:00:00
tabs: 
  - 设计模式
  - 发布-订阅模式
  - JavaScript
categories: 设计模式
urlname: observer-mode-of-design-patterns
---

> 观察者模式由两类对象组成：主体和观察者。比如一个对象被修改时，它会自动通知它的所有依赖对象。
> 那么主体就是这个对象，观察者就是通知它依赖对象的那个方法或者其它什么鬼。

<!-- more -->

## 代码
一个简单的观察者模式如下：
```typescript
interface  Handlers {
  [x:string]:Function[];
}
interface MyEvent<T = any> {
  [x:string]:T;
}
/** 观察者模式 */
class Observer {
  /** 保存观察类型和要执行的事件数组 */
  private handlers:Handlers = {};
  /** 验证参数 */
  private validateParams(type:string, handler:Function) {
    if (!type) {
      throw new Error('Param \'type\' is required!');
    }
    if (typeof handler !=='function') {
      throw new Error('Param  \'handler\' is required!');
    }
  }
  /** 添加事件 */
  public addHandler(type:string, handler:Function) {
    this.validateParams(type, handler);
    if (this.handlers[type] instanceof Array) {
      this.handlers[type].push(handler);
    } else {
      this.handlers[type] = [handler];
    }
  }
  /** 移除事件 */
  public removeHandler(type:string, handler:Function) {
    this.validateParams(type, handler);
    const typeHandlers = this.handlers[type];
    if (typeHandlers instanceof Array) {
      this.handlers[type] = typeHandlers.filter((item) => item !== handler);
    }
  }
  /** 执行该type的事件 - 观察者 */
  public dispatch(event:MyEvent) {
    if (typeof event !== 'object') {
      throw new Error('Param \'event\' should be a object!');
    }
    const { type } = event;
    if (!type) {
      throw new Error('Param \'type\' is required!');
    }
    if (!event.target) {
      event.target = this;
    }
    const typeHandlers = this.handlers[type];
    if (typeHandlers instanceof Array) {
      typeHandlers.forEach((item) => {
        if (typeof item === 'function') {
          item(event);
        }
      })
    }
  }
}

/** 主体 */
new Observer();
```

## 描述
上述代码主要包含四个部分：
- handlers: 保存观察者类型和要执行的事件函数。
- addHandler: 根据类型添加要执行的函数。
- removeHandler: 移除handler事件函数。
- dispatch: 每次执行将触发传入类型的函数组。

## 与发布-订阅模式
观察者模式包含两部分：
- 主体: 即要改变的对象或者其它。
- 观察者: 通知依赖主体的方法或者叫函数。

即主体变更时直接通知其特定的依赖对象，此时主体是

而发布-订阅模式

## 参考
- JavaScript高级程序设计